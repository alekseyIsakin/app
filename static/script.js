"use strict"

const test2 = {
    "uuid": "00000000-0000-0000-0000-000000000001",
    "name": "Тест самоопределения тревоги Д. Шихана",
    "description": "Определите, насколько Вас беспокоили в течение последней недели указанные ниже симптомы. Отметьте номер Вашего ответа на бланке ответов.",
    "answertags": [
        "def"
    ],
    "questionlist": [
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Затруднение на вдохе, нехватка воздуха или учащенное дыхание\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение удушья или комка в горле\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Сердце скачет, колотится, готово выскочить из груди\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Загрудинная боль, неприятное чувство сдавления в груди\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Профузная потливость (пот градом)\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Слабость, приступы дурноты, головокружения\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "\"Ватные\", \"не свои\" ноги\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение неустойчивости или потери равновесия\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Тошнота или неприятные ощущения в животе\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение того, что все окружающее становится странным, нереальным, туманным или отстраненнымОщущение того, что все окружающее становится странным, нереальным, туманным или отстраненным\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение, что все плывет, \"нахожусь вне тела\"\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Покалывание или онемение в разных частях тела\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Приливы жара или озноба\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Дрожь (тремор)\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Страх смерти или того, что сейчас может произойти что-то ужасное\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Страх сойти с ума или потери самообладания\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Внезапные приступы тревоги, сопровождающиеся тремя или более из вышеперечисленных признаков, возникающие непосредственно перед и при попадании в ситуацию, которая, по Вашему опыту, может вызвать приступ\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Внезапные неожиданные приступы тревоги, сопровождающиеся тремя или более из выше перечисленных признаков, возникающие по незначительным поводам или без повода (т.е., когда Вы НЕ находитесь в ситуации, которая, по Вашему опыту, может вызвать приступ)\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Внезапные неожиданные приступы, сопровождающиеся только одним или двумя из вышеперечисленных признаков, возникающие по незначительным поводам или без повода (т.е., когда Вы НЕ находитесь в ситуации, которая, по Вашему опыту, может вызвать приступ)\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Периоды тревоги, нарастающей по мере того, как Вы готовитесь сделать что-то, что, по Вашему опыту, может вызвать тревогу, причем более сильную, чем ту, что в таких случаях испытывает большинство людей\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Избегание пугающих вас ситуаций\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Состояние зависимости от других людей\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Напряженность и неспособность расслабиться\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Тревога, \"нервозность\", беспокойство\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Приступы повышенной чувствительности к звуку, свету и прикосновению\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Приступы поноса\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Чрезмерное беспокойство о собственном здоровье\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение усталости, слабости и повышенной истощаемости\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Головные боли или боли в шее\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Трудности засыпания\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Просыпания среди ночи или беспокойный сон\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Неожиданные периоды депрессии, возникающие по незначительным поводам или без повода\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Перепады настроения и эмоций, которые в основном зависят от того, что происходит вокруг Вас\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Повторяющиеся и неотступные представления, мысли, импульсы или образы, которые Вам кажутся тягостными, противными, бессмысленными или отталкивающими\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Повторение одного и того же действия как ритуала, например, повторные перепроверки, перемывание и пересчет при отсутствии в этом действии необходимости\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        }
    ],
    "diagnoses": {
        "def": {
            "тяжелое тревожное расстройство": 80,
            "клинически выраженная тревога": 30,
            "отсутствие клинически выраженной тревоги": 0
        }
    }
}

var button_holder = document.getElementsByClassName('button_holder')[0];
var test_holder = document.getElementsByClassName('test_holder')[0];
var next_btn = document.getElementById("next_button")
var gradient_holder = document.getElementById("gradient_holder");
var gradient = document.getElementById("gradient");

function setwidth(val) {
    let percent = 100 * ((Number(val) + 1) / test2.questionlist.length)
    
    gradient.setAttribute('style', `background: 
        linear-gradient(to right, green 0% ${percent - 4}%, yellow ${percent + 1}% 100%);`)
}

next_btn.addEventListener('click', () => {
    select_question( Number(localStorage['selected_quest']) + 1)
})

localStorage.clear()
localStorage['selected_quest'] = 0
localStorage[test2.uuid] = JSON.stringify({})

function get_question_id(question) {
    let arr = question.split(' ')
    if (arr.length == 0)
        return ''
    return `${arr[0]}`
}

function question_is_answered(question, remove = false) {
    if (!localStorage[test2.uuid])
        { localStorage[test2.uuid] = JSON.stringify({}) }
    
    let quest = get_question_id(question)
    let selected_quest = JSON.parse(localStorage[test2.uuid])

    // if (remove) {
    //     return
    // }

    selected_quest[quest] = question.split(' ').slice(-1)[0]
    localStorage[test2.uuid] = JSON.stringify(selected_quest)
}

function hide_all() {
    var test_holder = document.getElementsByClassName('test_holder')[0];

    for (let ch = 0; ch < test_holder.children.length; ch++) {
        test_holder.children[ch].hidden = true
    }
}

function button_click(event) {
    var question = event.rangeParent.parentNode.value
    select_question(question)
}

function select_question(question) {
    var btn = document.getElementsByClassName('question_btn')[question]
    var arr = document.getElementsByClassName('selected_btn')
    let selected_quests = JSON.parse(localStorage[test2.uuid])

    for (var ch = 0; ch < arr.length; ch++) {
        let question_id = arr[ch].value

        if (selected_quests[question_id]) {
            arr[ch].className = 'question_btn answered_btn'
        }
        else {
            arr[ch].className = 'question_btn'
        }
    }

    btn.className += ' selected_btn'

    hide_all()
    document.getElementsByClassName('question_block')[question].hidden = false
    setwidth(question)
    localStorage['selected_quest'] = question
}

function combo_box_answer_click(event) {
    var question = event.target.value
    question_is_answered(question)
}


for (let i = 0; i < test2.questionlist.length; i++) {

    let el = document.createElement('button')
    el.textContent = i
    el.setAttribute('value', i)
    el.addEventListener('click', button_click)

    el.className = 'question_btn'
    button_holder.appendChild(el)

    el = document.createElement('div')

    let p = document.createElement('p')
    p.textContent = test2.questionlist[i].Text
    el.appendChild(p)

    for (let j = 0; j < test2.questionlist[i].Questions.length; j++) {
        let d = document.createElement('div')
        let p = document.createElement('p')
        let combo_box = document.createElement('select')

        p.textContent = test2.questionlist[i].Questions[j]
        d.appendChild(p)
        d.appendChild(combo_box)

        for (let v = 0; v < test2.questionlist[i].Variants.length; v++) {

            let b = document.createElement('option')
            b.textContent = test2.questionlist[i].Variants[v]
            b.value = `${i} ${j} ${v}`
            
            combo_box.appendChild(b)
        }
        
        combo_box.addEventListener('click', combo_box_answer_click)
        d.className = 'question'

        el.appendChild(d)
    }
    el.hidden = true
    el.className = 'question_block'
    test_holder.appendChild(el)
}
<!DOCTYPE html>
<html>

<head>
  <title>Title of the document</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/style_test_builder.css">
</head>

<body>
  <div id="main_container">
    <div class="box header">
      <span class="header_text">header</span>
    </div>

    <div class="work_container">
      <div class="base_elemnt_holder">
        <div class="dragable_elements_holder">
          <p style="margin: 0px; background-color: yellowgreen;">elements</p>
          <div id="one_question_holder_" class="movable question_holder" ondrop="drop_put_to_question(event)" ondragover="dragover_handler(event)"
            draggable="true"></div>
          <p id="p1_" class="movable" draggable="true" style="margin: 0px; background-color: aqua;">p1</p>
          <p id="p2_" class="movable" draggable="true" style="margin: 0px; background-color: blue;">p2</p>
          <p id="p3_" class="movable" draggable="true" style="margin: 0px; background-color: rebeccapurple;">p3</p>
        </div>
        <div class="delete_drop" ondrop="drop_del_handler(event)" ondragover="dragover_handler(event)"> </div>
      </div>

      <div class="drop_receiver" ondrop="drop_put_handler(event)" ondragover="dragover_handler(event)">
        <span>header</span>
      </div>
      <div><span>header</span></div>
    </div>

    <div class="footer">
      <span>footer</span>

    </div>

  </div>
  <script>
    const tasksListElement = document.querySelector(`.dragable_elements_holder`);
    const dropReceivers = document.querySelector(`.drop_receiver`);
    let cur_id = 0
    function start_moving(event) {
      event.dataTransfer.setData("text/plain", event.target.id);
      event.target.classList.add(`selected`); 
    }
    function stop_moving(event) { event.target.classList.remove(`selected`); }

    tasksListElement.addEventListener(`dragstart`, start_moving)
    tasksListElement.addEventListener(`dragend`, stop_moving);

    function dragover_handler(ev) {
      ev.preventDefault();
      ev.dataTransfer.dropEffect = "move";
    }

    function drop_put_to_question(ev) {
      ev.preventDefault();
      console.count('one handler')
    }
    function drop_put_handler(ev) {
      ev.preventDefault();

      if (ev.target != dropReceivers) return

      let movable_id = ev.dataTransfer.getData('text')

      const activeElement = document.getElementById(movable_id)
      if (activeElement == null) return

      let newElemnt = activeElement
      
      if (activeElement.parentNode == tasksListElement) {
        newElemnt = activeElement.cloneNode(true)
        add_number_to_id(newElemnt)
      }
      
      newElemnt.addEventListener(`dragstart`, start_moving)
      newElemnt.addEventListener(`dragend`, stop_moving);
      newElemnt.classList.remove('selected')
      
      ev.currentTarget.appendChild(newElemnt)
    }
    function drop_del_handler(ev) {
      ev.preventDefault();
      const activeElement = dropReceivers.querySelector('.selected')
      activeElement.remove()
    }
    function add_number_to_id(element){
      element.id += String(cur_id)
      cur_id += 1
    }
  </script>
</body>

</html>
"use strict"

const test2 = {
    "uuid": "00000000-0000-0000-0000-000000000001",
    "name": "Тест самоопределения тревоги Д. Шихана",
    "description": "Определите, насколько Вас беспокоили в течение последней недели указанные ниже симптомы. Отметьте номер Вашего ответа на бланке ответов.",
    "answertags": [
        "def"
    ],
    "questionlist": [
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Затруднение на вдохе, нехватка воздуха или учащенное дыхание\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение удушья или комка в горле\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Сердце скачет, колотится, готово выскочить из груди\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Загрудинная боль, неприятное чувство сдавления в груди\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Профузная потливость (пот градом)\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Слабость, приступы дурноты, головокружения\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "\"Ватные\", \"не свои\" ноги\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение неустойчивости или потери равновесия\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Тошнота или неприятные ощущения в животе\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение того, что все окружающее становится странным, нереальным, туманным или отстраненнымОщущение того, что все окружающее становится странным, нереальным, туманным или отстраненным\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение, что все плывет, \"нахожусь вне тела\"\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Покалывание или онемение в разных частях тела\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Приливы жара или озноба\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Дрожь (тремор)\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Страх смерти или того, что сейчас может произойти что-то ужасное\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Страх сойти с ума или потери самообладания\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Внезапные приступы тревоги, сопровождающиеся тремя или более из вышеперечисленных признаков, возникающие непосредственно перед и при попадании в ситуацию, которая, по Вашему опыту, может вызвать приступ\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Внезапные неожиданные приступы тревоги, сопровождающиеся тремя или более из выше перечисленных признаков, возникающие по незначительным поводам или без повода (т.е., когда Вы НЕ находитесь в ситуации, которая, по Вашему опыту, может вызвать приступ)\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Внезапные неожиданные приступы, сопровождающиеся только одним или двумя из вышеперечисленных признаков, возникающие по незначительным поводам или без повода (т.е., когда Вы НЕ находитесь в ситуации, которая, по Вашему опыту, может вызвать приступ)\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Периоды тревоги, нарастающей по мере того, как Вы готовитесь сделать что-то, что, по Вашему опыту, может вызвать тревогу, причем более сильную, чем ту, что в таких случаях испытывает большинство людей\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Избегание пугающих вас ситуаций\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Состояние зависимости от других людей\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Напряженность и неспособность расслабиться\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Тревога, \"нервозность\", беспокойство\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Приступы повышенной чувствительности к звуку, свету и прикосновению\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Приступы поноса\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Чрезмерное беспокойство о собственном здоровье\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Ощущение усталости, слабости и повышенной истощаемости\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Головные боли или боли в шее\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Трудности засыпания\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Просыпания среди ночи или беспокойный сон\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Неожиданные периоды депрессии, возникающие по незначительным поводам или без повода\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Перепады настроения и эмоций, которые в основном зависят от того, что происходит вокруг Вас\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Повторяющиеся и неотступные представления, мысли, импульсы или образы, которые Вам кажутся тягостными, противными, бессмысленными или отталкивающими\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        },
        {
            "MaxRate": 4,
            "MinRate": 0,
            "UnicValues": false,
            "Type": "QuestionRateAnswer",
            "Text": null,
            "Questions": [
                "Повторение одного и того же действия как ритуала, например, повторные перепроверки, перемывание и пересчет при отсутствии в этом действии необходимости\n"
            ],
            "Variants": [
                "Нисколько - 0",
                "Немного - 1",
                "Умеренно - 2",
                "Сильно - 3",
                "Крайне сильно - 4"
            ],
            "VariantsTag": [
                "def"
            ]
        }
    ],
    "diagnoses": {
        "def": {
            "тяжелое тревожное расстройство": 80,
            "клинически выраженная тревога": 30,
            "отсутствие клинически выраженной тревоги": 0
        }
    }
}

var question_holder = document.getElementById("question_holder")
var next_btn = document.getElementById("click_next")
var prev_btn = document.getElementById("click_prev")

var gradient_holder = document.getElementById("gradient_holder");
var gradient = document.getElementById("gradient");
var selected_quest_str = document.getElementById("selected_question")

function setwidth(val) {
    let percent = 100 * ((Number(val) + 1) / test2.questionlist.length)
    
    gradient.setAttribute('style', `background: 
        linear-gradient(to right, green 0% ${percent - 4}%, yellow ${percent + 1}% 100%);`)
}

next_btn.addEventListener('click', () => {
    select_question( Number(localStorage['selected_quest']) + 1)
})
prev_btn.addEventListener('click', () => {
    select_question( Number(localStorage['selected_quest']) - 1)
})

function get_question_id(question) {
    let arr = question.split(' ')
    if (arr.length == 0)
        return ''
    return `${arr[0]}`
}

function question_is_answered(question, remove = false) {
    if (!localStorage[test2.uuid])
        { localStorage[test2.uuid] = JSON.stringify({}) }
    
    let quest = get_question_id(question)
    let selected_quest = JSON.parse(localStorage[test2.uuid])

    selected_quest[quest] = question.split(' ').slice(-1)[0]
    localStorage[test2.uuid] = JSON.stringify(selected_quest)
}

function hide_all() {
    var test_holder = document.getElementsByClassName('one_question');

    for (let ch = 0; ch < test_holder.length; ch++) {
        test_holder[ch].hidden = true
    }
}

function button_click(event) {
    var question = event.rangeParent.parentNode.value
    select_question(question)
}

function select_question(question) {
    if (question < 0 || question >= test2.questionlist.length)
        { return }

    hide_all()
    document.getElementsByClassName('one_question')[question].hidden = false
    selected_quest_str.textContent = `<\xa0\xa0\xa0${question + 1} / ${test2.questionlist.length}\xa0\xa0\xa0>`
    localStorage['selected_quest'] = question
}

function combo_box_answer_click(event) {
    var question = event.target.value
    question_is_answered(question)
}



for (let i = 0; i < test2.questionlist.length; i++) {
    let question_div = document.createElement('div')
    let text_question = document.createElement('p')

    text_question.textContent = test2.questionlist[i].Text
    question_div.className = "one_question"
    question_div.setAttribute("align", "center")

    for (let j = 0; j < test2.questionlist[i].Questions.length; j++) {
        let question_variant = document.createElement('div')
        let p = document.createElement('p')
        let combo_box = document.createElement('select')
        
        combo_box.className = "drop-down"
        combo_box.style.textAlign = "center"

        p.className = "question"
        p.style.borderWidth = 0
        p.textContent = test2.questionlist[i].Questions[j]

        for (let v = 0; v < test2.questionlist[i].Variants.length; v++) {

            let b = document.createElement('option')
            b.textContent = test2.questionlist[i].Variants[v]
            b.value = `${i} ${j} ${v}`
            
            combo_box.appendChild(b)
        }

        question_variant.appendChild(p)
        question_variant.appendChild(combo_box)
        question_div.appendChild(question_variant)
    }


    question_div.hidden = true
    question_div.appendChild(text_question)
    question_holder.appendChild(question_div)
}


localStorage.clear()
localStorage['selected_quest'] = 0
localStorage[test2.uuid] = JSON.stringify({})
selected_quest_str.className = "default_text"
select_question(0)
